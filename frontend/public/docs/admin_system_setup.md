# 管理画面によるシステム全体セットアップ手順

本書では、管理画面を用いてシステムを運用開始できる状態にするまでの流れを説明します。初期セットアップや設定変更時の参考にしてください。

## 1. 管理画面へのログイン
1. 患者画面右上の「管理画面」ボタンをクリックします。
2. パスワードが初期状態（"admin"）の場合、まずパスワード設定モーダルが開きます。新しいパスワードを2回入力して保存してください。保存後は自動的に管理画面へログインします。
    - 保存後、Authenticator を有効にするか確認するダイアログが表示されます。QR コードを表示して有効化するか、後で設定するかを選択できます。
    - Authenticator を有効にしない場合、パスワードのリセット機能は利用できません。パスワードを忘れた場合はパスワードリセットページにシステム初期化（`backend/tools/reset_admin_password.py` の実行）を指示する案内が表示されます。後から設定したい場合は管理画面の「セキュリティ」から行ってください。
    - 環境変数 `ADMIN_PASSWORD` を既に独自設定している場合はその値が初期値として引き継がれるため、このモーダルは表示されません。
3. 既にパスワードが設定済みの場合はログインモーダルが表示されます。管理者パスワードを入力し、「ログイン」を押します。
4. 認証に成功するとテンプレート一覧ページが開きます。

## 2. システム表示名の設定
1. 左メニューから「システム表示名」を選択します。
2. 表示されたフォームにクリニック名など任意の表示名を入力し、「保存」を押します。
3. 保存後、患者向け画面のヘッダーに即時反映されます。

## 3. 問診テンプレートの準備
1. 左メニューの「テンプレート」を開きます。
2. 「新しいテンプレート名」を入力してテンプレートを作成します。初診用と再診用をそれぞれ作成してください。
3. 問診項目一覧の下にある「問診項目を追加」ボタンから、質問文・入力方法・必須設定・初診/再診への適用を設定します。
4. 条件表示を利用する場合は `when` 設定で表示条件を追加できます。
5. 右上の「プレビュー」ボタンで患者画面での表示を確認します。
6. 編集内容はユーザー操作時に自動保存されます。必要に応じて保存完了を確認してください。

## 4. LLM 設定
1. 左メニューの「LLM設定」を開きます。
2. `provider` を選択します（`local`/`ollama`/`lm_studio`）。
3. 遠隔サーバーを利用する場合は `base_url` と `api_key` を入力します。
4. 「疎通テスト」を実行し、成功したら「保存」を押します。
5. テンプレート側の「追質問を有効化」チェックは、LLM設定が有効かつ疎通テストに成功している場合のみオンにできます。

## 5. 動作確認
1. 左メニューの「問診結果」で送信済みセッションを確認できます。
2. 患者画面に戻り、新しいセッションを開始して各設定が反映されているか確認します。

## 6. 付録：使い方ページ
管理メニューの「使い方」ページでは、本ドキュメントが表示されます。院内マニュアルとして活用してください。

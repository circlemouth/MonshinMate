# 医療機関向け UI デザイン改修計画（問診システム）

本書は plannedSystem.md（システム全体設計）に整合しつつ、医療機関で運用される問診システムとして違和感のない UI/UX へブラッシュアップするための具体的な改修計画を示す。実装は最小リスクで段階的に進め、既存フロー（患者・管理）と API 契約を維持することを原則とする。

## 1. 目的・背景
- 現場（受付・診察前）の実利用に耐える、安心感と可読性を最重視した UI に改修。
- 誤操作・入力ミスを抑え、看護師/事務スタッフによる支援もしやすい画面設計を実現。
- plannedSystem.md の非機能要件（反応 < 300ms、明示的なフェイルセーフ）と整合。

## 2. デザイン原則（医療現場向け）
- 明瞭性: 文言は平易・短文、医療用語は必要最小限に留め補助説明を併記。
- 一貫性: コンポーネントの配置・間隔・文言を統一（デザインシステム化）。
- 視認性: コントラスト比 WCAG AA 以上（文字 4.5:1、見出し 3:1）。
- 可操作性: タッチ 44x44px、フォーカスリング可視、フォームのタブ移動最適化。
- フェイルセーフ: ネット断/LLM障害でもベース問診のみで完了可能であることを UI 上も明示。
- 安心表示: フッターに「ローカル LLM で外部送信なし」を常時表示（既存仕様を維持）。

## 3. ターゲット環境
- 端末: iPad（10–11inch）/ 13–15inch ノート PC / 24inch デスクトップ。
- 入力: タッチ主体 + ソフトキーボード、スタッフ代行入力はキーボード主体も想定。
- 照度: 明るい院内照明（ライトテーマ基本、必要に応じハイコントラストテーマ）。

## 4. 画面フロー（整合確認）
- 患者: Entry（氏名/生年月日）→ 初診/再診 → ベース問診 → 追加質問 → 最終確認 → 完了。
- 管理: ログイン → ダッシュボード → テンプレ CRUD → LLM 設定。
- plannedSystem.md の 1.2/3.5/4 と整合。API 契約は変更しない（追加 UI はフロント内閉域で完結）。

## 5. デザイントークン（Design Tokens）
- 色: `primary`, `secondary`, `success`, `warning`, `danger`, `neutral(0..900)`。
- タイポ: ベース 16px、スケール 1.125（H1 28–32, H2 24, H3 20, Body 16, Small 14）。
- スペーシング: `4px` グリッド（`4/8/12/16/24/32`）。
- 角丸/影: `radius-8` を基本、モーダル/カードは控えめな影。
- モーション: 150–200ms、reduce motion 対応（OS設定尊重）。
- ブレークポイント: `sm 600px / md 960px / lg 1280px / xl 1600px`。

## 6. カラーパレット（医療領域推奨）
- Primary: やや desaturated な青系（信頼/安心）例: `#1E88E5`/`#1565C0`。
- Success: `#2E7D32`、Warning: `#ED6C02`、Danger: `#D32F2F`。
- Background: `#FAFAFA`（患者画面）/ `#FFFFFF`（カード）/ `#F5F5F5`（管理）。
- Text: `#212121`/`#424242`。リンク `#1565C0`。要素間の仕切りは薄いグレー（`#E0E0E0`）。
- すべての前景/背景の組み合わせで AA 達成を確認（色弱シミュレータで検証）。

## 7. タイポグラフィ
- 日本語: Noto Sans JP / BIZ UD ゴシック（可読性・等幅数字の視認性重視）。
- 英数字: Inter / Roboto。
- 数字入力（年齢/日付/電話）は等幅数字の利用を推奨。

## 8. コンポーネント仕様（抜粋）
- Button: `primary/secondary/ghost` + `sm/md/ld`。連打防止の一時無効化とローディング表示。
- TextField: ラベル上、必須アスタリスク、ヘルプテキスト、例示（placeholder 過多は避ける）。
- NumberField: ステッパー除去、テンキー誘導（`inputmode=numeric`/`pattern`）。
- DatePicker: 直接入力 + カレンダー選択、過去日制約、和暦表示は任意（院内規程次第）。
- Radio/Segmented: 初診/再診、男女などは水平並び（2–3択）。
- Checkbox: 同意/確認項目用。多選択は `Chip` 型 UI で誤タップ低減。
- Select: 候補が多い場合のみ。少数なら Radio 優先。
- Stepper/Progress: 主要ステップを上部に表示。進行率（%）は 5% 刻み。
- Alert/Inline Error: フィールド直下 + 上部まとめ（最小）。
- Modal/Drawer: 追加説明や確認で使用。ESC/外側クリックで閉じるが、重要操作は明示ボタンで。
- Toast: 成功/失敗の簡易通知（2–4 秒）。

## 9. フォーム UX 詳細
- 入力補助: オートフォーカス、前後ナビゲーション、候補サジェスト（患者が迷う用語には説明アイコン）。
- バリデーション: 入力中は軽量、送信時に確定チェック。エラーは一文で具体的に。
- 入力保持: 画面遷移/リロードでドラフト保持（sessionStorage）。
- キーボード/スクリーンリーダ: ランドマーク/ラベル/aria を付与、フォーカス移動を制御。

## 10. レイアウト/レスポンシブ
- レイアウト: 最大行幅 ~ 72–80 文字。PC は 2 カラム（質問/補助説明）、タブレット/モバイルは 1 カラム。
- スペーシング: セクション間 24–32px、フィールド間 16–24px。
- 固定フッター: 注意文と操作エリアは十分な余白とコントラスト。

## 11. アクセシビリティ（A11y）
- コントラスト AA、フォーカス可視、キー操作全完結、フォーム関連の `aria-*` 実装。
- エラー時に役割 `role=alert`、説明と連動する `aria-describedby`。
- 言語切替（必要時）の `lang` 属性と日付/数値のローカル表記。

## 12. セキュリティ/プライバシー UI
- 画面覗き見対策: 入力中の非アクティブ行は薄く、完了後は値のみ表示に切替。
- タイムアウト: 一定無操作でロック画面（説明と再開/破棄）。
- フッター常時表示: 「ローカル LLM / 外部送信なし」。

## 13. 印刷/出力
- `@media print` の最適化（背景オフ、等幅フォント、要約の見出し/改ページ制御）。
- 医師用要約の行間と余白を広めに、A4 1–2 枚で収まる体裁。

## 14. 観測/計測（UI 側）
- 主要イベント: 画面滞留時間、エラー発生率、離脱ポイント、追加質問の回数と所要時間。
- 患者個人を特定しない匿名メトリクスで収集（院内規程順守）。

## 15. 実装計画（WBS / 優先度順）
1. デザイン原則・トークン・パレットを定義（Figma + tokens.ts）。
2. ベースレイアウト（ヘッダー/フッター/コンテナ）とタイポ/スペーシング反映。
3. フォーム要素（Text/Number/Date/Radio/Checkbox/Select）を設計・差し替え。
4. Stepper/Progress、Alert/Error、Toast、Modal の整備。
5. 画面ごとの情報設計（Entry/VisitType/Questionnaire/Questions/Review/Done）。
6. アクセシビリティ対応（ラベル、aria、フォーカス、コントラスト）。
7. 印刷スタイル、計測イベントの配線、E2E 確認。

## 16. 受け入れ基準（UI）
- 可読性: iPad と 1080p で 1m 距離から無理なく読める。
- 一貫性: コンポーネントの大きさ、間隔、色、文言が統一。
- 操作性: 主要操作は 3 ステップ以内、エラーからの復帰が直観的。
- A11y: コントラスト AA、フォーカス可視、SR 読み上げが正しい。
- プライバシ: フッターの安心表示、印刷体裁の適正。

## 17. リスクと緩和
- 過度な UI 変更で学習コスト増 → 導線と名称は踏襲、視覚強調のみ変更。
- 色/フォントの違和感 → 院内プレビュー（看護/事務）で逐次フィードバック。
- 期間超過 → 優先度順で分割リリース（フォーム → 補助 UI → 印刷）。

## 18. デザイン連携 / 運用
- Figma ファイル: コンポーネント化（Variants/Auto Layout）、アクセシビリティ検証プラグイン併用。
- トークン同期: `tokens.json|ts` を基準に CSS 変数へ展開、フロントで参照。
- レビュー: 週次で UI 差分を共有し、plannedSystem.md の要件に差異がないか確認。

---

最終的な反映は frontend のコンポーネント差し替えとスタイル適用で行う。API 仕様変更は不要。E2E/UAT の観点は docs/implementation.md のテスト手順（§7）に準拠する。
